---
# Namespace for TLS practice
apiVersion: v1
kind: Namespace
metadata:
  name: tls-demo

---
# TLS Secret
# This is created manually from the certificates generated by 01-generate-certificates.sh
# In production, cert-manager would create this automatically

# NOTE: This file is a template. You need to populate it with actual certificate data.
# Two ways to create this Secret:

# Method 1: Imperative (easier, recommended)
# Run this command after generating certificates:
#   kubectl create secret tls secure-app-tls \
#     --cert=./certs/tls.crt \
#     --key=./certs/tls.key \
#     -n tls-demo

# Method 2: Declarative (this YAML file)
# You need to base64-encode your certificates and paste below:
#   cat ./certs/tls.crt | base64 -w 0
#   cat ./certs/tls.key | base64 -w 0

---
# For learning purposes, we'll use the imperative method (Method 1).
# If you want to use this YAML, uncomment below and add your base64-encoded certs:

# apiVersion: v1
# kind: Secret
# type: kubernetes.io/tls
# metadata:
#   name: secure-app-tls
#   namespace: tls-demo
# data:
#   # Replace with your base64-encoded certificate:
#   tls.crt: LS0tLS1CRUdJTi...  # base64 encoded
#   # Replace with your base64-encoded private key:
#   tls.key: LS0tLS1CRUdJTi...  # base64 encoded

---
# What is type: kubernetes.io/tls?
# - Special Secret type for TLS certificates
# - Enforces that data contains tls.crt and tls.key
# - Used by Ingress controllers for HTTPS termination
# - Base64-encoded by Kubernetes (you provide decoded files in Method 1)

# How Ingress uses this Secret:
# 1. Client connects to Ingress (HTTPS request for secure-app.local)
# 2. Ingress Controller reads Secret: secure-app-tls
# 3. Ingress sends tls.crt to client during TLS handshake
# 4. Ingress uses tls.key to decrypt client's encrypted message
# 5. TLS session established â†’ encrypted communication
# 6. Ingress forwards decrypted HTTP request to backend Service

# Native resources:
#   - Secret (type: kubernetes.io/tls)
#   - No pods/deployments created by the Secret itself
#   - Ingress Controller reads this Secret when handling HTTPS

# Inspect with:
#   kubectl get secret secure-app-tls -n tls-demo
#   kubectl describe secret secure-app-tls -n tls-demo
#   kubectl get secret secure-app-tls -n tls-demo -o yaml

# Verify Secret has correct structure:
#   kubectl get secret secure-app-tls -n tls-demo -o jsonpath='{.data}' | jq
#   # Should show: {"tls.crt": "...", "tls.key": "..."}

# Decode and inspect certificate from Secret:
#   kubectl get secret secure-app-tls -n tls-demo -o jsonpath='{.data.tls\.crt}' | base64 -d | openssl x509 -text -noout
